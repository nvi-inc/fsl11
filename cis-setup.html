<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<meta name="author" content="Dave Horsley and Ed Himwich">
<title>CIS hardening for FSL11</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book">
<div id="header">
<h1>CIS hardening for FSL11</h1>
<div class="details">
<span id="author" class="author">Dave Horsley and Ed Himwich</span><br>
<span id="revdate">Version 1.1.4 - April 2024</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_document_revision_history">Document revision history</a></li>
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#_applying_cis_remediations">2. Applying CIS remediations</a>
<ul class="sectlevel2">
<li><a href="#_installation_partition_configuration">2.1. Installation partition configuration</a></li>
<li><a href="#_post_installation_remediations">2.2. Post-installation remediations</a>
<ul class="sectlevel3">
<li><a href="#_scripted_remediations">2.2.1. Scripted remediations</a></li>
<li><a href="#_reboot">2.2.2. Reboot</a></li>
<li><a href="#_additional_remediations">2.2.3. Additional remediations</a></li>
</ul>
</li>
<li><a href="#_additional_cis_policies">2.3. Additional CIS policies</a>
<ul class="sectlevel3">
<li><a href="#_1_5_2_ensure_bootloader_password_is_set">1.5.2 Ensure bootloader password is set</a></li>
<li><a href="#_1_8_1_2_ensure_the_local_login_warning_banner_is_configured_properly">1.8.1.2 Ensure the local login warning banner is configured properly</a></li>
<li><a href="#_1_8_1_3_ensure_the_remote_login_warning_banner_is_configured_properly">1.8.1.3 Ensure the remote login warning banner is configured properly</a></li>
<li><a href="#_1_8_2_ensure_gdm_login_banner_is_configured_properly">1.8.2 Ensure GDM login banner is configured properly</a></li>
<li><a href="#_2_2_1_4_ensure_ntp_is_configured">2.2.1.4 Ensure ntp is configured</a></li>
<li><a href="#_4_1_2_3_ensure_system_is_disabled_when_audit_logs_are_full">4.1.2.3 Ensure system is disabled when audit logs are full</a></li>
<li><a href="#_4_2_1_5_ensure_rsyslog_is_configured_to_send_logs_to_a_remote_host">4.2.1.5 Ensure rsyslog is configured to send logs to a remote host</a></li>
<li><a href="#_5_2_16_ensure_ssh_idle_timeout_interval_is_configured">5.2.16 Ensure SSH Idle Timeout Interval is configured</a></li>
<li><a href="#_5_3_1_ensure_password_creation_requirements_are_configured">5.3.1 Ensure password creation requirements are configured</a></li>
<li><a href="#_5_3_2_ensure_lockout_for_failed_password_attemtps_is_enabled">5.3.2 Ensure lockout for failed password attemtps is enabled</a></li>
<li><a href="#_5_4_1_4_ensure_inactive_password_lock_is_30_days_or_less">5.4.1.4 Ensure inactive password lock is 30 days or less</a></li>
</ul>
</li>
<li><a href="#_other_policies">2.4. Other policies</a>
<ul class="sectlevel3">
<li><a href="#_tcp_wrappers_configuration">2.4.1. TCP wrappers configuration</a></li>
<li><a href="#_set_log_retention_period">2.4.2. Set log retention period</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_cis_exceptions">3. CIS Exceptions</a>
<ul class="sectlevel2">
<li><a href="#_1_4_2_ensure_filesystem_integrity_is_regularly_checked">1.4.2 Ensure filesystem integrity is regularly checked</a></li>
<li><a href="#_1_5_2_ensure_bootloader_password_is_set_2">1.5.2 Ensure bootloader password is set</a></li>
<li><a href="#_2_2_2_ensure_x_window_system_is_not_installed">2.2.2 Ensure X Window System is not installed</a></li>
<li><a href="#_2_2_4_ensure_cups_is_not_enabled">2.2.4 Ensure CUPS is not enabled</a></li>
<li><a href="#_3_5_2_5_ensure_firewall_rules_exist_for_all_open_ports">3.5.2.5 Ensure firewall rules exist for all open ports</a></li>
<li><a href="#_3_5_3_7_ensure_nftables_service_is_enabled">3.5.3.7 Ensure nftables service is enabled</a></li>
<li><a href="#_3_5_3_8_ensure_nftables_rules_are_permanent">3.5.3.8 Ensure nftables rules are permanent</a></li>
<li><a href="#_4_2_1_5_ensure_rsyslog_is_configured_to_send_logs_to_a_remote_log_host">4.2.1.5 Ensure rsyslog is configured to send logs to a remote log host</a></li>
<li><a href="#_5_2_6_ensure_ssh_x11_forwarding_is_disabled">5.2.6 Ensure SSH X11 forwarding is disabled</a></li>
<li><a href="#_5_3_2_ensure_lockout_for_failed_password_attempts_is_configured">5.3.2 Ensure lockout for failed password attempts is configured</a></li>
</ul>
</li>
<li><a href="#_cis_remediation_problems">4. CIS Remediation problems</a>
<ul class="sectlevel2">
<li><a href="#_1_1_10_ensure_noexec_option_set_on_vartmp_partition">1.1.10 Ensure noexec option set on /var/tmp partition</a></li>
<li><a href="#_1_4_2_ensure_filesystem_integrity_is_regularly_checked_2">1.4.2 Ensure filesystem integrity is regularly checked</a></li>
<li><a href="#_1_5_1_ensure_the_permissions_on_the_bootloader_are_configured">1.5.1 Ensure the permissions on the bootloader are configured</a></li>
<li><a href="#_2_2_1_4_ensure_ntp_is_configured_2">2.2.1.4 Ensure ntp is configured</a></li>
<li><a href="#_3_3_4_ensure_suspicious_packets_are_logged">3.3.4 Ensure suspicious packets are logged</a></li>
<li><a href="#_4_1_5_ensure_events_that_modify_the_systems_network_environment_are_collected">4.1.5 Ensure events that modify the system&#8217;s network environment are collected</a></li>
<li><a href="#_4_1_16_ensure_kernel_module_loading_and_unloading_is_collected">4.1.16 Ensure kernel module loading and unloading is collected</a></li>
<li><a href="#_4_2_3_ensure_permissions_on_all_logfiles_are_configured">4.2.3 Ensure permissions on all logfiles are configured</a></li>
<li><a href="#_6_1_6_ensure_permissions_on_etcpasswd_are_configured">6.1.6 Ensure permissions on /etc/passwd- are configured</a></li>
<li><a href="#_6_1_7_ensure_permissions_on_etcshadow_are_configured">6.1.7 Ensure permissions on /etc/shadow- are configured</a></li>
<li><a href="#_6_1_8_ensure_permissions_on_etcgroup_are_configured">6.1.8 Ensure permissions on /etc/group- are configured</a></li>
<li><a href="#_6_1_11_ensure_no_unowned_files_or_directories_exist">6.1.11 Ensure no unowned files or directories exist</a></li>
<li><a href="#_6_1_12_ensure_no_ungroup_files_or_directories_exist">6.1.12 Ensure no ungroup files or directories exist</a></li>
</ul>
</li>
<li><a href="#_additional_items_for_fs_operations">Appendix A: Additional items for FS operations</a>
<ul class="sectlevel2">
<li><a href="#_fix_ups">A.1. Fix-ups</a></li>
<li><a href="#_enabling_user_promotion_to_operprog_and_root">A.2. Enabling user promotion to oper/prog and root</a></li>
<li><a href="#_adding_auid_accounts">A.3. Adding AUID accounts</a></li>
<li><a href="#_copy_ssh_key_for_running_backup_usr2">A.4. Copy ssh key for running backup_usr2</a></li>
<li><a href="#_enable_operators_group_accounts_to_rotate_disks">A.5. Enable operators group accounts to rotate disks</a></li>
<li><a href="#_setting_hostname_alias">A.6. Setting hostname alias</a></li>
<li><a href="#_installing_backup_usr2_with_cis_hardening">A.7. Installing backup_usr2 with CIS hardening</a></li>
<li><a href="#_using_backup_usr2_with_cis_hardening">A.8. Using backup_usr2 with CIS hardening</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_document_revision_history">Document revision history</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>1.1.3&#8201;&#8212;&#8201;Disable <em>oper</em> and <em>prog</em> password expiration, they don&#8217;t have passwords</p>
</li>
<li>
<p>1.1.2&#8201;&#8212;&#8201;Correct responses to <em>adduser</em>; create <em>~AUID/.ssh</em> in case
it doesn&#8217;t already exist</p>
</li>
<li>
<p>1.1.1&#8201;&#8212;&#8201;Use <em>backup_user2</em> to run <em>refresh_spare_usr2</em> for CIS
hardening, removing <em>enable_spare</em> and <em>disable_spare</em>; add copying
key for backup_usr2</p>
</li>
<li>
<p>1.1.0&#8201;&#8212;&#8201;Add installing AUID use of <em>refresh_spare_usr2</em>; add new
section on AUID use of <em>refresh_spare_usr2</em> section using
<em>enable_spare</em> and <em>disable_spare</em>; restructure installing <em>sudo</em>
access for rotation scripts and <em>root</em> account; remove UID/GID
parallelism; correct use of <em>computer</em> when <em>system</em> is correct</p>
</li>
<li>
<p>1.0.5&#8201;&#8212;&#8201;Limit AUID options for <em>refresh_secondary</em></p>
</li>
<li>
<p>1.0.4&#8201;&#8212;&#8201;Remove <em>shutdown</em>, <em>reboot</em>, and <em>refresh_spare_usr2</em> from
<em>sudoers</em>; cleanup <em>refresh_spare_usr2</em> only for <em>root</em></p>
</li>
<li>
<p>1.0.3&#8201;&#8212;&#8201;Optionally disable oper/prog shell time-out</p>
</li>
<li>
<p>1.0.2&#8201;&#8212;&#8201;Add no GUI login and other new remediations</p>
</li>
<li>
<p>1.0.1&#8201;&#8212;&#8201;Fix typo in desktop setup</p>
</li>
<li>
<p>1.0.0&#8201;&#8212;&#8201;Initial release</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>These notes detail adding extra security features to Field System
Linux <em>11</em>, FSL11, as advised by Center for Internet Security (CIS).
This is provided as an option for sites that might need additional
security.</p>
</div>
<div class="paragraph">
<p>At the time of this writing, there is no CIS security benchmark for
Debian <em>11</em>, which is what FSL11 is based on. Instead, the latest
benchmark for Debian <em>10</em> was used. Although this is not technically
correct, the changes in the benchmark for Debian <em>10</em> compared to
Debian <em>9</em> were relatively minor; primarily removal of items. It seems
plausible that the Debian <em>10</em> benchmark will be adequate for Debian
<em>11</em>. In fact, all of the items that fail for FSL11 are either things
that are required for  FS operation, items that appear to actually be
secure despite the benchmark not recognizing them as such, and one
change since Debian <em>10</em> that we worked around.  However, we don&#8217;t
know what additional checks will be in the Debian <em>11</em> benchmark.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Additional steps needed to use the benchmark:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the package <code>default-jre</code> with <em>apt-get</em>.</p>
</li>
<li>
<p>Disable the <em>java</em> version check in <em>CIS-CAT.sh</em>.</p>
</li>
<li>
<p>Change <code>ignore.platform.mismatch</code> to <code>true</code> in
<em>misc/ciscat.properties</em>.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With the exception of the partition configuration, all actions are to
be performed post-installation (see the <a href="installation.html">FSL11
Installation</a> document). Applying the remediations, the exceptions
that are still present, all tests that failed, and problems with the
benchmark remediations are provided in separate sections below. An
appendix covers additional setup that is needed for FS operations
after the remediations have been applied.</p>
</div>
<div class="paragraph">
<p>This document  is based on the results for the &#8220;CIS Debian Linux 10
Benchmark v1.0.0 - Level 2 - Server&#8221;.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_applying_cis_remediations">2. Applying CIS remediations</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_installation_partition_configuration">2.1. Installation partition configuration</h3>
<div class="paragraph">
<p>During installation, be sure to create the logical volumes marked
optional in the partition setup section.</p>
</div>
</div>
<div class="sect2">
<h3 id="_post_installation_remediations">2.2. Post-installation remediations</h3>
<div class="paragraph">
<p>All commands need to be run as <em>root</em>.</p>
</div>
<div class="sect3">
<h4 id="_scripted_remediations">2.2.1. Scripted remediations</h4>
<div class="paragraph">
<p>As many remediations as possible are implemented by the <em>remediate</em>
script.  The script is intended to be run after the &#8220;Third Stage
Installation&#8221; steps in the FSL11 instructions, before any further
changes have been made to the system (however initializing and adding
other disks to the RAID can intervene).</p>
</div>
<div class="paragraph">
<p>To apply these remediations, execute the commands:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd /root/fsl11
script ../remediate.txt
./remediate
exit</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
This script should not be run more than once on a system.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The use of the <em>script</em> command causes the output to be recorded
in the specified file. This can be very helpful for understanding what
went wrong if the script fails. The script itself uses the <code>-x</code> option
to echo the commands as they are executed to make it easy to match the
output with the commands being executed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_reboot">2.2.2. Reboot</h4>
<div class="paragraph">
<p>The system should be rebooted to make sure all the remediations have
been applied. Some aren&#8217;t enforced until a reboot.</p>
</div>
<div class="paragraph">
<p>After the reboot, all the CIS remediations that can applied at this
point have been completed. The
<a href="#_additional_cis_policies">Additional CIS policies</a> subsection below describes some other
policies that can be considered.</p>
</div>
</div>
<div class="sect3">
<h4 id="_additional_remediations">2.2.3. Additional remediations</h4>
<div class="paragraph">
<p>The subsection applies a second round of scripted remediations and an
unscripted remediation that both go beyond the CIS benchmark. Before
applying the scripted remediations, an account must be created that
will have the ability to promote to <em>root</em>. Please see the
<a href="#_enabling_user_promotion_to_operprog_and_root">Enabling user promotion to oper/prog and root</a> and
<a href="#_adding_auid_accounts">Adding AUID accounts</a> sections of the
<a href="#_additional_items_for_fs_operations">Additional items for FS operations</a> appendix for the details of
configuring such an account.</p>
</div>
<div class="sect4">
<h5 id="_run_the_script">Run the script</h5>
<div class="paragraph">
<p>To apply the scripted remediations, execute the commands:</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
These scripted remediations including disabling direct
<em>root</em> login. If there is no account that is able to promote to
<em>root</em> before they are applied, it will become impossible to get
<em>root</em> access.
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre>cd /root/fsl11
script ../remediate2.txt
./remediate2
exit</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
This script should not be run more than once on a system.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This script will place a backup of all the original files modified by
the script in the directory <em>/root/remediate2_backups</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_unscripted_remediation">Unscripted remediation</h5>
<div class="paragraph">
<p>This remediation is to specify a FQDN for a server in the
<em>/etc/ntp.conf</em> file. The server must be within the same second-level
domain as the system being hardened. If you using the recommended FS
NTP configuration, you can add lines for the <code><em>FQDN</em></code> after the lines
for the <code><em>alias</em></code> of the server. There must be <em>exactly</em> one space (no
tabs) between <code>server</code> and the <code><em>FQDN</em></code>. The result would be something
like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># if you update this one, also update the FQDN version below
server      <em>alias</em> iburst minpoll 4
restrict    <em>alias</em> kod notrap nomodify nopeer noquery
#
# if you update this one, also update the aliased version above
server <em>FQDN</em> iburst minpoll 4
restrict <em>FQDN</em> kod notrap nomodify nopeer noquery</pre>
</div>
</div>
<div class="paragraph">
<p>The lines for the <em>alias</em> may still work to locate the server if there
is a DNS problem.  The comments may help get the correct result if
this server changes.</p>
</div>
</div>
<div class="sect4">
<h5 id="_second_remediation_reboot">Second remediation reboot</h5>
<div class="paragraph">
<p>The system should be rebooted to make sure all the remediations have
been applied. Some aren&#8217;t enforced until a reboot.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
After this reboot, the GUI login on the console will be
disabled.  Locally, it will only be possible to login on a text
console.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_additional_cis_policies">2.3. Additional CIS policies</h3>
<div class="paragraph">
<p>This section lists further topics related to the benchmark that should
be discussed. The items are listed by benchmark section numbers.</p>
</div>
<div class="sect3">
<h4 id="_1_5_2_ensure_bootloader_password_is_set">1.5.2 Ensure bootloader password is set</h4>
<div class="paragraph">
<p>You may wish to create an encrypted password with
grub-mkpasswd-pbkdf2:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>grub-mkpasswd-pbkdf2
Enter password: &lt;password&gt;
Reenter password: &lt;password&gt;
Your PBKDF2 is &lt;encrypted-password&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Add the following into  a custom <em>/etc/grub.d</em> configuration file
(don&#8217;t use <em>/etc/grub.d/00_header</em> as it can be overwritten by a
package update):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cat &lt;&lt;EOF
set superusers="&lt;username&gt;"
password_pbkdf2 &lt;username&gt; &lt;encrypted-password&gt;
EOF</pre>
</div>
</div>
<div class="paragraph">
<p>If there is a requirement to be able to boot/reboot without entering
the password, edit <em>/etc/grub.d/10_linux</em> and add <code>--unrestricted</code> to the
line <code>CLASS=</code></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
It is strongly recommended that booting without a password
be permitted. Otherwise, if a reboot is required to continue
operations it will not be possible unless some one with the password
is available. If they aren&#8217;t available, this could lead to a safety
issue or loss of VLBI data.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CLASS="--class gnu-linux --class gnu --class os --unrestricted"</pre>
</div>
</div>
<div class="paragraph">
<p>Run the following commands to update the grub2 configuration and reset
the <em>grub.cfg</em> permissions:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>update-grub
chmod go-rwx /boot/grub/grub.cfg</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_1_8_1_2_ensure_the_local_login_warning_banner_is_configured_properly">1.8.1.2 Ensure the local login warning banner is configured properly</h4>
<div class="paragraph">
<p>You may want to update <em>/etc/issue</em> to have a more tailored message
with sterner warnings. The message must not include use of <code>\m</code>, <code>\r</code>,
<code>\s</code>, <code>\v</code>, or references to the OS platform.</p>
</div>
</div>
<div class="sect3">
<h4 id="_1_8_1_3_ensure_the_remote_login_warning_banner_is_configured_properly">1.8.1.3 Ensure the remote login warning banner is configured properly</h4>
<div class="paragraph">
<p>You may want to update <em>/etc/issue.net</em> to have a more tailored
message with sterner warnings. The message must not include use of
<code>\m</code>, <code>\r</code>, <code>\s</code>, <code>\v</code>, or references to the OS platform.</p>
</div>
</div>
<div class="sect3">
<h4 id="_1_8_2_ensure_gdm_login_banner_is_configured_properly">1.8.2 Ensure GDM login banner is configured properly</h4>
<div class="paragraph">
<p>You may want to update <em>/etc/gdm3/greeter.dconf-defaults</em> to have a
more tailored message with sterner warnings.</p>
</div>
<div class="paragraph">
<p>If desired, you can remove the Debian logo from the GUI login page by
renaming the file specified for the <code>logo</code> option of the
<code>[org/gnome/login-screen]</code> section in
<em>/etc/gdm3/greeter/dconf-defaults</em>. For example, if appropriate, you
might use:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd /usr/share/images/vendor-logos
mv logo-text-version-64.png logo-text-version-64.png.bak</pre>
</div>
</div>
<div class="paragraph">
<p>If desired, you can remove the Debian logo from the <em>grub</em> menu by
renaming the file specified for in the <code>if</code> clause for the
<code>background_image</code> file in the <code>/etc/grub.d/05_debian_theme</code> section
of <em>/boot/grub/grub.cfg</em>. For example, if appropriate, you might use:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd /usr/share/desktop-base/homeworld-theme/grub
mv grub-4x3.png grub-4x3.png.bak</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Caveat Emptor! The changes below in this <strong>IMPORTANT</strong> section may not
be safe. Even if they appear to be successful, they may case problems
later. The problems may include failure of automatic updates. They may
also need to be reinstalled after updates.</p>
</div>
<div class="paragraph">
<p>After making any or all of these changes, it is necessary to execute:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>update-grub</pre>
</div>
</div>
<div class="paragraph">
<p>for them to take effect.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In principle, you can remove the <code>Debian</code> label from the <em>grub</em> boot
menus by editing <em>/etc/default/grub</em> and inserting a line:</p>
<div class="literalblock">
<div class="content">
<pre>GRUB_DISTRIBUTOR=FSL11</pre>
</div>
</div>
<div class="paragraph">
<p>immediately after the existing <code>GRUB_DISTRIBUTOR=&#8230;&#8203;</code> line.</p>
</div>
</li>
<li>
<p>In principle, you can remove the <code>GNU/Linux</code> label from the <em>grub</em>
boot menus by editing <em>/etc/grub.d/10_linux</em> and inserting a line:</p>
<div class="literalblock">
<div class="content">
<pre>OS="${GRUB_DISTRIBUTOR}"</pre>
</div>
</div>
<div class="paragraph">
<p>immediately after the existing <code>OS="${GRUB_DISTRIBUTOR} GNU/Linux"</code>
line.</p>
</div>
</li>
<li>
<p>In principle, you can remove the <code>Linux</code> label from the lines
displaying kernel image files, by editing <em>/etc/grub.d/10_linux</em> and
globally replacing <code>&#160;Linux&#160;</code> (note the single leading and
single trailing spaces) with <code>&#160;FSL11&#160;</code> (not the single
leading and single trailing spaces).</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_2_2_1_4_ensure_ntp_is_configured">2.2.1.4 Ensure ntp is configured</h4>
<div class="paragraph">
<p>This needs the  FS NTP configuration. That is more secure than the
benchmark since it uses <code>ignore</code> by default.</p>
</div>
</div>
<div class="sect3">
<h4 id="_4_1_2_3_ensure_system_is_disabled_when_audit_logs_are_full">4.1.2.3 Ensure system is disabled when audit logs are full</h4>
<div class="paragraph">
<p>This may not be appropriate for an operational system.</p>
</div>
</div>
<div class="sect3">
<h4 id="_4_2_1_5_ensure_rsyslog_is_configured_to_send_logs_to_a_remote_host">4.2.1.5 Ensure rsyslog is configured to send logs to a remote host</h4>
<div class="paragraph">
<p>To set a remote log host, edit the <em>/etc/rsyslog.conf</em> and/or the
<em>/etc/rsyslog.d/*.conf</em> files and add lines like the following
(replace angle bracket items, <code>&lt;&#8230;&#8203;&gt;</code>, with your values):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;files to sent to the remote log server&gt; action(type="omfwd" target="&lt;FQDN or ip of loghost&gt;" port="&lt;port number&gt;" protocol="tcp"
action.resumeRetryCount="&lt;number of re-tries&gt;"
queue.type="linkList" queue.size=&lt;number of messages to queue&gt;")</pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="literalblock">
<div class="content">
<pre>*.* @@&lt;FQDN or ip of loghost&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Run the following command to reload the <em>rsyslog</em> configuration:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>systemctl reload rsyslog</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_5_2_16_ensure_ssh_idle_timeout_interval_is_configured">5.2.16 Ensure SSH Idle Timeout Interval is configured</h4>
<div class="paragraph">
<p>Five minutes is too short and is not commensurate with the recommended
15 minute auto-logout interval.</p>
</div>
</div>
<div class="sect3">
<h4 id="_5_3_1_ensure_password_creation_requirements_are_configured">5.3.1 Ensure password creation requirements are configured</h4>
<div class="paragraph">
<p>Should the minimum be reduced to 12 characters?</p>
</div>
</div>
<div class="sect3">
<h4 id="_5_3_2_ensure_lockout_for_failed_password_attemtps_is_enabled">5.3.2 Ensure lockout for failed password attemtps is enabled</h4>
<div class="paragraph">
<p>The number of login failures before lock-out can cause a problem if it
is set too low. The main issue is for an operator working at odd
hours, alone, at a remote location, and dealing with multiple issue,
which might include: power failures, equipment problems, and
logistical issues. It can be a chaotic situation. Typing long and
complicated passwords in the heat of battle, particularly if they vary
between machines, can be error-prone. Being locked-out will make the
situation more difficult and may increase the amount of data that will
be lost.</p>
</div>
<div class="paragraph">
<p>If you find that the number of login failures before lock-out is too
small, you can increase it by increasing the value of the <code>deny</code>
parameter (<code>5</code> in the example below, other typical parameters are
omitted and should not be changed) in:</p>
</div>
<div class="listingblock">
<div class="title">/etc/pam.d/common-auth</div>
<div class="content">
<pre class="highlight"><code>auth required pam_faillock.so deny=5</code></pre>
</div>
</div>
<div class="paragraph">
<p>Small integer values (<code>20</code> or less) should not be a significant risk
with long and complicated passwords and a unlock time of several
minutes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_5_4_1_4_ensure_inactive_password_lock_is_30_days_or_less">5.4.1.4 Ensure inactive password lock is 30 days or less</h4>
<div class="paragraph">
<p>This is too short for developers/troubleshooters. A value of <code>60</code>
would be commensurate with the password reset interval.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_other_policies">2.4. Other policies</h3>
<div class="paragraph">
<p>This subsection describes other policies beyond the CIS benchmark that
may be desirable.</p>
</div>
<div class="sect3">
<h4 id="_tcp_wrappers_configuration">2.4.1. TCP wrappers configuration</h4>
<div class="paragraph">
<p>You may wish to configure TCP wrappers.</p>
</div>
<div class="sect4">
<h5 id="_etchosts_deny">/etc/hosts.deny</h5>
<div class="paragraph">
<p>Add:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ALL:ALL</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_etchosts_allow">/etc/hosts.allow</h5>
<div class="paragraph">
<p>Add:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sshd:ALL</pre>
</div>
</div>
<div class="paragraph">
<p>It is recommended that you further restrict <em>sshd</em> to specific hosts
and/or sub-domains.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_set_log_retention_period">2.4.2. Set log retention period</h4>
<div class="paragraph">
<p>You may want to set the retention period of system logs by
editing <em>/etc/logrotate.conf</em> and/or <em>/etc/logrotate.d/*</em>, as
appropriate.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cis_exceptions">3. CIS Exceptions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section addresses the tests that failed in the CIS benchmark
after all the remediations in this document were applied. The items
are listed by benchmark section numbers.</p>
</div>
<div class="sect2">
<h3 id="_1_4_2_ensure_filesystem_integrity_is_regularly_checked">1.4.2 Ensure filesystem integrity is regularly checked</h3>
<div class="paragraph">
<p>The AIDE system now performs a check daily and generates a report, so
this is no longer needed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_5_2_ensure_bootloader_password_is_set_2">1.5.2 Ensure bootloader password is set</h3>
<div class="paragraph">
<p>This must be set later by the system administrator.</p>
</div>
</div>
<div class="sect2">
<h3 id="_2_2_2_ensure_x_window_system_is_not_installed">2.2.2 Ensure X Window System is not installed</h3>
<div class="paragraph">
<p>The X11 Window system is required for FS use.</p>
</div>
</div>
<div class="sect2">
<h3 id="_2_2_4_ensure_cups_is_not_enabled">2.2.4 Ensure CUPS is not enabled</h3>
<div class="paragraph">
<p>The CUPS printing systems is required for operations.</p>
</div>
</div>
<div class="sect2">
<h3 id="_3_5_2_5_ensure_firewall_rules_exist_for_all_open_ports">3.5.2.5 Ensure firewall rules exist for all open ports</h3>
<div class="paragraph">
<p>There is a <em>ufw</em> rule for <em>Openssh</em> (port 22), but the benchmark
doesn&#8217;t accept that. Additional openings can be added as needed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_3_5_3_7_ensure_nftables_service_is_enabled">3.5.3.7 Ensure nftables service is enabled</h3>
<div class="paragraph">
<p>Although the benchmark also uses <em>ufw</em>, which is enabled and uses
<em>nftables</em>, for some reason this is not recognized.</p>
</div>
</div>
<div class="sect2">
<h3 id="_3_5_3_8_ensure_nftables_rules_are_permanent">3.5.3.8 Ensure nftables rules are permanent</h3>
<div class="paragraph">
<p>Although the benchmark also uses <em>ufw</em>, which has permanent rules  and
uses <em>nftables</em>, for some reason this is not recognized.</p>
</div>
</div>
<div class="sect2">
<h3 id="_4_2_1_5_ensure_rsyslog_is_configured_to_send_logs_to_a_remote_log_host">4.2.1.5 Ensure rsyslog is configured to send logs to a remote log host</h3>
<div class="paragraph">
<p>A remote log server must be configured later by the system
administrator.</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_6_ensure_ssh_x11_forwarding_is_disabled">5.2.6 Ensure SSH X11 forwarding is disabled</h3>
<div class="paragraph">
<p>Using <em>ssh</em> X11 forwarding is required for for remote FS operations
and testing.</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_3_2_ensure_lockout_for_failed_password_attempts_is_configured">5.3.2 Ensure lockout for failed password attempts is configured</h3>
<div class="paragraph">
<p>The benchmark, which is for Debian <em>10</em>, uses <em>pam_tally2.so</em> for
this. However <em>pam_tally2.so</em> is not available in Debian <em>11</em>, having
been replaced with <em>pam_faillock.so</em>. The <em>remediate</em> script
implements the intent of the recommended <em>pam_tally2.so</em> configuration
with <em>pam_faillock.so</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
To reset a locked-out user after CIS hardening, as <em>root</em>  use
<code><strong>faillock --user <em>username</em>  --reset</strong></code> where <code><strong><em>username</em></strong></code> is the
user account. Leave off the <code>--reset</code> to see what the current failure
count is.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cis_remediation_problems">4. CIS Remediation problems</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section details problems with the recommended remediations.  The
items are listed by benchmark section numbers.</p>
</div>
<div class="paragraph">
<p>Some problems were worked around by adding a boot time <em>systemd</em>
service <code>CISfix</code> to correct changes that occur on a reboot.</p>
</div>
<div class="sect2">
<h3 id="_1_1_10_ensure_noexec_option_set_on_vartmp_partition">1.1.10 Ensure noexec option set on /var/tmp partition</h3>
<div class="paragraph">
<p>Enforcing this requirement for the currently running system before all
the other remediations have been applied can interfere with execution
of <code>apt-get install &#8230;&#8203;</code> to install packages needed for the
remediation. Instead, although <em>/etc/fstab</em> is updated in sequence,
remounting the file systm is deferred to the end.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_4_2_ensure_filesystem_integrity_is_regularly_checked_2">1.4.2 Ensure filesystem integrity is regularly checked</h3>
<div class="paragraph">
<p>The <em>/etc/crontab</em> entry that should be added is missing the user
(<em>root</em>) field. Additionally Debian no longer provides <em>aide.wrapper</em>.
However, the AIDE system now performs a check daily and generates a
report, so this is no longer needed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_5_1_ensure_the_permissions_on_the_bootloader_are_configured">1.5.1 Ensure the permissions on the bootloader are configured</h3>
<div class="paragraph">
<p>The permissions are reset every time <em>update-grub</em> is run, e.g., for a
kernel update. Fixing them was added to the <code>CISfix</code> <em>systemd</em>
service at boot.</p>
</div>
</div>
<div class="sect2">
<h3 id="_2_2_1_4_ensure_ntp_is_configured_2">2.2.1.4 Ensure ntp is configured</h3>
<div class="paragraph">
<p>The remediation makes it less secure. A default policy of <code>ignore</code> is
better.</p>
</div>
</div>
<div class="sect2">
<h3 id="_3_3_4_ensure_suspicious_packets_are_logged">3.3.4 Ensure suspicious packets are logged</h3>
<div class="paragraph">
<p>The remediation lines added in <em>/etc/sysctl.d/*</em> for this issue are
not respected at boot (unlike all others). To overcome this, the
following lines are used in the <code>CISfix</code> <em>systemd</em> service at boot.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sysctl -w net.ipv4.conf.all.log_martians=1
sysctl -w net.ipv4.conf.default.log_martians=1
sysctl -w net.ipv4.route.flush=1</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_4_1_5_ensure_events_that_modify_the_systems_network_environment_are_collected">4.1.5 Ensure events that modify the system&#8217;s network environment are collected</h3>
<div class="paragraph">
<p>The 64-bit remediation had the <code>b64</code> and the <code>b32</code> rules concatenated
on one line.</p>
</div>
</div>
<div class="sect2">
<h3 id="_4_1_16_ensure_kernel_module_loading_and_unloading_is_collected">4.1.16 Ensure kernel module loading and unloading is collected</h3>
<div class="paragraph">
<p>The 64-bit remediation was missing the <code>b32</code> rule.</p>
</div>
</div>
<div class="sect2">
<h3 id="_4_2_3_ensure_permissions_on_all_logfiles_are_configured">4.2.3 Ensure permissions on all logfiles are configured</h3>
<div class="paragraph">
<p>There are two issues:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The recommended remediation makes the entire directory tree
<em>/var/log</em> unsearchable by everyone except <em>root</em>. This breaks some
functionality, in particular email. As a result, the remediation was
scaled back to just the minimum required to pass the test, which was
to just set the permission on the files themselves instead changing
the directory permissions as well. This could be made more targeted.
For example to allow email use, just <em>/var/log</em> and <em>/var/log/exim4</em>
could be made searchable.</p>
</li>
<li>
<p>The permissions for some logfiles are reset each time the system
reboots. Fixing them was added to the <code>CISfix</code> <em>systemd</em> service at
boot.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_6_1_6_ensure_permissions_on_etcpasswd_are_configured">6.1.6 Ensure permissions on /etc/passwd- are configured</h3>
<div class="paragraph">
<p>The permissions are reset each time the system reboots. Fixing them
was added to the <code>CISfix</code> <em>systemd</em> service at boot.</p>
</div>
</div>
<div class="sect2">
<h3 id="_6_1_7_ensure_permissions_on_etcshadow_are_configured">6.1.7 Ensure permissions on /etc/shadow- are configured</h3>
<div class="paragraph">
<p>The permissions are reset each time the system reboots. Fixing them
was added to the <code>CISfix</code> <em>systemd</em> service at boot.</p>
</div>
</div>
<div class="sect2">
<h3 id="_6_1_8_ensure_permissions_on_etcgroup_are_configured">6.1.8 Ensure permissions on /etc/group- are configured</h3>
<div class="paragraph">
<p>The permissions are reset each time the system reboots. Fixing them
was added to the <code>CISfix</code> <em>systemd</em> service at boot.</p>
</div>
</div>
<div class="sect2">
<h3 id="_6_1_11_ensure_no_unowned_files_or_directories_exist">6.1.11 Ensure no unowned files or directories exist</h3>
<div class="paragraph">
<p>After each boot, the file <em>/var/cache/private/fwupdmgr</em> has no owner.
Fixing that was added to the <code>CISfix</code> <em>systemd</em> service at boot.</p>
</div>
</div>
<div class="sect2">
<h3 id="_6_1_12_ensure_no_ungroup_files_or_directories_exist">6.1.12 Ensure no ungroup files or directories exist</h3>
<div class="paragraph">
<p>After each boot, the file <em>/var/cache/private/fwupdmgr</em> has no group.
Fixing that was added to the <code>CISfix</code> <em>systemd</em> service at boot.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_additional_items_for_fs_operations">Appendix A: Additional items for FS operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After the CIS hardening is completed, some additional set-up is
needed. In addition, one item below gives the procedure for running
<em>refresh_spare_user</em> with CIS hardening.</p>
</div>
<div class="sect2">
<h3 id="_fix_ups">A.1. Fix-ups</h3>
<div class="paragraph">
<p>There are two issues that may need to be corrected after the CIS
hardening.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Using the <code>noexec</code> option for <em>/tmp</em> causes a problem for the
package management system. The <em>dpkg-preconfigure</em> program places and
executes scripts on <em>/tmp</em> as part of package installation. The
<code>noexec</code> option prevents the execution of the scripts. To work around
this issue, you can exeucte:</p>
<div class="literalblock">
<div class="content">
<pre>cd /root/fsl11/
./root_tmp</pre>
</div>
</div>
<div class="paragraph">
<p>The <em>root_tmp</em> script performs three actions:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Creates a one time service at boot to clean the <em>/root/tmp</em> directory</p>
</li>
<li>
<p>Sets <em>dpkg-preconfigure</em> to use <em>/root/tmp</em> for temporary files</p>
</li>
<li>
<p>Creates an initial <em>/root/tmp</em> directory</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>There may be other issues with using the <code>noexec</code> option for <em>/tmp</em>,
but we don&#8217;t have any specifics at this time.</p>
</div>
</li>
<li>
<p>Sometimes the firewall (<em>ufw</em>) does not work properly after rebooting.
This has been noticed for remote access to <em>gromet</em> for met. data on
port 50001. There are no other known issues. An apparent fix for this
is to disable and re-enable the firewall. If you have this problem and
the same solution works, a one-time service at start-up can be created
to perform this action:</p>
<div class="literalblock">
<div class="content">
<pre>cd /root/fsl11
./create_ufw_re-enable</pre>
</div>
</div>
<div class="paragraph">
<p>The new service will run at the next reboot. It is configured to run
<em>after</em> <em>ufw</em> has been started.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_enabling_user_promotion_to_operprog_and_root">A.2. Enabling user promotion to oper/prog and root</h3>
<div class="paragraph">
<p>The model used in the FS assumes <em>oper</em> and <em>prog</em> accounts will be
used for operations and programming respectively. However, some
organizations may have security and auditing restrictions that mean
operators must login using their own account (possibly named with
their Agency User ID, or AUID). As the FS currently operates, users
will then need to switch, i.e., <em>promote</em>, to the <em>oper</em> or <em>prog</em>
account after login. Likewise, if a user is allowed to promote to
<em>root</em>, they will need to do so after logging into their own account.
This subsection covers how to enable this capability. The next
subsection, <a href="#_adding_auid_accounts">Adding AUID accounts</a>, covers how to add an AUID
account.</p>
</div>
<div class="paragraph">
<p>For <em>oper</em> and <em>prog</em>, we suggest creating two groups that can <em>sudo</em>
to the accounts. Run <em>visudo</em>, then add at end:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>%operators      ALL=(oper) ALL
%programmers    ALL=(prog) ALL
%programmers    ALL=(oper) ALL</pre>
</div>
</div>
<div class="paragraph">
<p>If they don&#8217;t already exist, create the needed groups:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>addgroup operators
addgroup programmers</pre>
</div>
</div>
<div class="paragraph">
<p>If they don&#8217;t already, set <em>oper</em> and <em>prog</em> to have <em>bash</em> as their
login shells:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>chsh -s /bin/bash oper
chsh -s /bin/bash prog</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
When promoting to <em>oper</em> and <em>prog</em> (and <em>root</em>), the only
supported login shell for the target accounts is <em>bash</em>. It would be
possible to support <em>tcsh</em>. That would require adding promotion
machinery to the <em>~/.login</em> files that is equivalent to what is in the
current <em>~/.profile</em> files. Please contact Ed for more information.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Optionally, to disable shell inactivity time-outs for <em>oper</em>, <em>prog</em>,
and/or AUID accounts, edit their respective <em>.bashrc</em> files and
uncomment the line:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>unset TMOUT</pre>
</div>
</div>
<div class="paragraph">
<p>If the accounts, and <em>desktop</em>, haven&#8217;t been disabled for login
already, do so:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>usermod -L oper
usermod -L prog
usermod -L desktop</pre>
</div>
</div>
<div class="paragraph">
<p>Disable password aging and account inactivity expiration for those
accounts. Execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>chage -I -1 -M 99999 oper
chage -I -1 -M 99999 prog
chage -I -1 -M 99999 desktop</pre>
</div>
</div>
<div class="paragraph">
<p>To prevent connecting with <em>ssh</em> using a key, create (or add <em>oper</em>
and <em>prog</em> to an existing) <code>DenyUsers</code> line in <em>/etc/ssh/sshd_config</em>:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you used the CIS <em>remediate</em> script, you should comment out
the line: <code>DenyGroup rtx</code> as well.
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre>DenyUsers desktop oper prog</pre>
</div>
</div>
<div class="paragraph">
<p>And restart <em>sshd</em> with:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>systemctl restart sshd</pre>
</div>
</div>
<div class="paragraph">
<p>Authorized users can then switch to <em>oper</em> with (similarly for
<em>prog</em> and <em>root</em>):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo -i -u oper</pre>
</div>
</div>
<div class="paragraph">
<p>The <em>sudo</em> command will prompt for the AUID account&#8217;s password.
Within a session, <em>sudo</em> will not prompt again for 15 minutes after
its last successful use.</p>
</div>
<div class="paragraph">
<p>The following example steps are used to ensure that X11 authorization
works. This example is for user <em>oper</em> and works analogously for
<em>prog</em> and <em>root</em> (but see the paragraph at the end of step (1) for
more information about <em>root</em>'s configuration). After the steps are
presented, there is information on a script that implements these
changes for all three accounts in one step.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add this to the following file:</p>
<div class="listingblock">
<div class="title">~oper/.profile</div>
<div class="content">
<pre class="highlight"><code>#
# authorise XCOOKIE for remote users
if ! [ -z ${XCOOKIE+x} ]; then
   xauth add $XCOOKIE
fi
# set .Xresources/window-manager coming from AUID accounts
if ! [ -z ${DISPLAY+x} ]; then
#   NOT no DISPLAY defined, do something (otherwise do nothing)
    if echo $DISPLAY |grep -q localhost; then
#       ssh from remote host with X display
        xrdb -merge ~/.Xresources
    else
#       login shell (because this is .profile) on the local X console
        xrdb -merge ~/.Xresources
        setsid fvwm --replace &gt;/dev/null 2&gt;&amp;1 &amp;
    fi
fi
#
# include AUID user's .profile_SUDO_USER
if [ -n "$SUDO_USER" ]; then
    if [ -f "$HOME/.profile_$SUDO_USER" ]; then
        . "$HOME/.profile_$SUDO_USER"
    fi
fi</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will also set the Xresources to those of <em>oper</em>, replace the
current window manager with one owned by <em>oper</em> (protected from
<span class="keyseq"><kbd>Ctrl</kbd>+<kbd>C</kbd></span> by <em>setsid</em>) for a local console X11 session, and run a
<em>bash</em> script (if present) to apply customizations for the <em>sudo</em>
user. (For <em>root</em> only the first clause would be used since Xresources
would not be set, the window manager would not be replaced, and there
would not be <em>sudo</em> user customization.)</p>
</div>
</li>
<li>
<p>Create the following file</p>
<div class="listingblock">
<div class="title">/usr/local/bin/oper_account</div>
<div class="content">
<pre class="highlight"><code>set -e

if [ "$USER" = "prog" ]; then
  echo "ERROR: Cannot promote to oper from $USER account. Promote from $SUDO_USER instead."
  exit 1
elif [ "$USER" = "oper" ]; then
  echo "ERROR: Already in $USER account."
  exit 1
fi

if [ -z ${DISPLAY+x} ]; then
#   no DISPLAY set
    sudo -u oper -i "$@"
elif echo $DISPLAY |grep -q localhost; then
#   remote user
    sudo -u oper XCOOKIE="$(xauth list $DISPLAY)" -i "$@"
else
#   on console X server
    if ! xhost|grep -q 'SI:localuser:oper'; then
        xhost +SI:localuser:oper &gt;/dev/null
    fi
    sudo -u oper -i "$@"
fi</code></pre>
</div>
</div>
</li>
<li>
<p>Execute:</p>
<div class="literalblock">
<div class="content">
<pre>chmod a+rx /usr/local/bin/oper_account</pre>
</div>
</div>
</li>
<li>
<p>Create the following file:</p>
<div class="listingblock">
<div class="title">/usr/local/bin/oper_x11</div>
<div class="content">
<pre class="highlight"><code>set -e

if [ $USER = "prog" ]; then
  echo "ERROR: Cannot promote to oper from $USER account. Promote from $SUDO_USER instead."
  exit 1
elif [ $USER = "oper" ]; then
  echo "ERROR: Already in $USER account."
  exit 1
fi

if tty|grep -q ^/dev/tty ;then
    export AUID_PROMOTE_ACCOUNT=oper
    startx &gt;/dev/null 2&gt;&amp;1
else
    echo "Only text console users are allowed to run the X server, use 'oper_account'."
fi</code></pre>
</div>
</div>
</li>
<li>
<p>Execute:</p>
<div class="literalblock">
<div class="content">
<pre>chmod a+rx /usr/local/bin/oper_x11</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>To execute the five numbered steps above for <em>oper</em> and <em>prog</em> and the
first three for <em>root</em> (for the latter only those three are needed),
enter:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>~/fsl11/AUID/install_AUID</pre>
</div>
</div>
<div class="paragraph">
<p>The <em>oper_account</em>, <em>prog_account</em>, and <em>root_account</em> scripts can be
used to promote any AUID session to those accounts. The <em>oper_x11</em> and
<em>prog_x11</em> scripts can be used on a text console to start an X11
session and promote.</p>
</div>
</div>
<div class="sect2">
<h3 id="_adding_auid_accounts">A.3. Adding AUID accounts</h3>
<div class="paragraph">
<p>This subsection describes how to add AUID accounts to be used with the
ability to promote to <em>oper</em>, <em>prog</em>, and <em>root</em> as described in the
previous subsection. The method described here uses <em>dhorsley</em> as an
example AUID account name.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the user account:</p>
<div class="literalblock">
<div class="content">
<pre>adduser dhorsley --home /usr2/dhorsley</pre>
</div>
</div>
<div class="paragraph">
<p>Enter a suitable password when prompted and confirm it. Answer all
other questions with <kbd>Enter</kbd>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
If you are configuring a <em>spare</em> system, you will need to
make sure the same accounts and groups for the owners of files on
<em>/usr2</em> exist on both systems (but the UIDs and GIDs don&#8217;t need to be
the same) for the system-to-system backup of <em>/usr2</em> to work properly.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>For normal operations, AUID users' home directories should be on
<em>/usr2</em>. However, for some maintenance accounts, it may make sense to
have the home directory some where else, typically on <em>/home</em>. In that
case, use this command instead:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>adduser dhorsley</pre>
</div>
</div>
<div class="paragraph">
<p>The step for setting the contents of the home directory below will
need to be adjusted accordingly; see the <a href="#note">NOTE</a> farther below.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Add the user to these groups as appropriate, e.g.:</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This step assumes that the <em>operators</em> and <em>programmers</em> groups
have been created as described in the previous subsection
<a href="#_enabling_user_promotion_to_operprog_and_root">Enabling user promotion to oper/prog and root</a>.
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre>adduser dhorsley operators</pre>
</div>
</div>
<div class="paragraph">
<p>and/or:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>adduser dhorsley programmers</pre>
</div>
</div>
</li>
<li>
<p>If the user should be able to manage printers, use:</p>
<div class="literalblock">
<div class="content">
<pre>adduser dhorsley lpadmin</pre>
</div>
</div>
</li>
<li>
<p>If the user is allowed to elevate to <em>root</em>, use <em>visudo</em> to add:</p>
<div class="literalblock">
<div class="content">
<pre>dhorsley       ALL=(root) ALL</pre>
</div>
</div>
</li>
<li>
<p>If the account will be used by an operator and/or programmer with
the GUI, the X11 environment needs to be set-up. The following command
will move an existing <em>/usr2/dhorsley</em> to <em>/usr2/dhorsley.FSCOPY</em> and
create a new <em>/usr2/dhorsley</em> with useful skeleton files (you will be
prompted for the account name):</p>
<div class="literalblock">
<div class="content">
<pre>/usr2/fs/misc/auid_update</pre>
</div>
</div>
<div class="paragraph">
<p>It will also create <em>~oper/.profile_dhorsley and _~prog/.profile_dhorsley</em>
scripts for per AUID user customization of <em>oper</em> and <em>prog</em> sessions.
The initial versions of this file just print a message as a reminder
that they are being used:</p>
</div>
<div class="listingblock">
<div class="title">~oper/.profile_dhorsley</div>
<div class="content">
<pre class="highlight"><code>echo "Applying customizations from ${BASH_SOURCE}"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><a id="note"></a><a href="#note">NOTE</a>: If the user&#8217;s home directory is not on <em>/usr2</em>,
but is for example on <em>/home</em>, the following commands should be used
instead:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd /home
mv dhorsley dhorsley.FSCOPY
cd /usr2/fs/st.default/auid
find . -print|cpio -pmdu /home/dhorsley
chown -R dhorsley.dhorsley /home/dhorsley
chmod 0750 /home/dhorsley</pre>
</div>
</div>
<div class="paragraph">
<p>No <em>oper</em>/<em>prog</em> customization scripts are included. It is assumed
that since these accounts aren&#8217;t on <em>/usr2</em> that they aren&#8217;t used for
operations.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Set default desktop</p>
<div class="paragraph">
<p>To set the correct default desktop (it is remembered per user):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cat &gt; /var/lib/AccountsService/users/dehorsley &lt;&lt;EOF
[User]
Language=
XSession=default
Icon=/usr2/dehorsley/.face
SystemAccount=false
EOF</pre>
</div>
</div>
<div class="paragraph">
<p>Normally, the GUI login is disabled if the security remediations of
this document have been applied. If the GUI login is available and you
have access to the console, an alternative means for setting the
desktop is:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Press <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>F1</kbd></span> to get to the GUI login.</p>
</li>
<li>
<p>Enter <code><strong>dhorsley</strong></code> as the <code>Username</code>.</p>
</li>
<li>
<p>Select the &#8220;gear&#8221; icon in the lower right-hand corner.</p>
</li>
<li>
<p>Select <code>System X11 Default</code>.</p>
</li>
<li>
<p>Complete logging in with the password.</p>
</li>
<li>
<p>Logout with <code>exit</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>You may wish to proceed to the next section
<a href="#_copy_ssh_key_for_running_backup_usr2">Copy ssh key for running backup_usr2</a> if that is appropriate for
this user.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_copy_ssh_key_for_running_backup_usr2">A.4. Copy ssh key for running backup_usr2</h3>
<div class="paragraph">
<p>For each AUID account that will use <em>backup_usr2</em>, copy the <em>ssh</em> key
from <em>root</em> on the <em>operational</em> system to the AUID account on the
<em>operational</em> system. The AUID account must have been created on both
systems before using this method.</p>
</div>
<div class="paragraph">
<p>As <em>root</em> on the <em>operational</em> system:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a key:</p>
<div class="paragraph">
<p>If the <em>root</em> account already has a key, you should skip this step.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Your should <em>not</em> set a passphrase.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>ssh-keygen</pre>
</div>
</div>
</li>
<li>
<p>Copy the key to to the <em>authorized_keys</em> for each AUID user that
will use <em>backup_usr2</em>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The first command below will generate an error <code>File exists</code> if
the directory already exists. That is benign and can be ignored.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>mkdir ~<em>AUID</em>/.ssh
cat /root/.ssh/id_rsa.pub &gt;&gt;~<em>AUID</em>/.ssh/authorized_keys</pre>
</div>
</div>
<div class="paragraph">
<p>where <code><em>AUID</em></code> is the AUID account that will use <em>backup_usr2</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The key now stored in the AUID account on the <em>operational</em>
system will be copied to that account on the <em>spare</em> system the next
time <em>backup_usr2</em> is run. Until then, this user would need to enter
their password to connect to the <em>spare</em> system when running
<em>backup_usr2</em>.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_enable_operators_group_accounts_to_rotate_disks">A.5. Enable operators group accounts to rotate disks</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allow <em>operators</em> to use the <em>sudo</em> scripts <em>rotation_shutdown</em>
(with any options) and <em>refresh_secondary</em> (but only with no options
or with the <code>-h</code> or <code>-p</code> options individually), by adding
(respectively) with <em>visudo</em>:</p>
<div class="literalblock">
<div class="content">
<pre>%operators      ALL=(ALL) /usr/local/sbin/rotation_shutdown
%operators      ALL=(ALL) /usr/local/sbin/refresh_secondary ""
%operators      ALL=(ALL) /usr/local/sbin/refresh_secondary -h
%operators      ALL=(ALL) /usr/local/sbin/refresh_secondary -p</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
A user who can elevate to <em>root</em> will be able to run
<em>refresh_secondary</em> with any options if they use <em>sudo</em> explicitly.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Install <em>AUID</em> scripts to allow <code>operators</code> group accounts to run
the <em>sudo</em> scripts without explicitly entering <em>sudo</em>:</p>
<div class="literalblock">
<div class="content">
<pre>AUID/install_RAID</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The scheme here uses scripts that are run with <em>sudo</em> (the so-called
<em>sudo scripts</em>) for steps that require elevated privileges. These are
installed in <em>/usr/local/sbin</em>. For ease of use with the <code>operators</code>
group (typically AUID) accounts, additional scripts (the so-called
<em>AUID scripts</em>) with the same names that run the <em>sudo</em> scripts are
installed in <em>/usr/local/bin</em>. The AUID scripts verify that the <em>oper</em>
and <em>prog</em> accounts are not in use before running the <em>sudo</em> versions
with <em>sudo</em>. This cuts down on error messages from <em>sudo</em> and saves
AUID users from needing to enter <em>sudo</em>.</p>
</div>
<div class="paragraph">
<p>This works for <em>root</em> (and <em>sudo</em>) users because <em>/usr/local/sbin</em>
appears before <em>/usr/local/bin</em> in users' <code>PATH</code> variables. It works
for non-<em>root</em> (and non-<em>sudo</em>) users because the versions in
<em>/usr/local/sbin</em> are only executable by <em>root</em>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_setting_hostname_alias">A.6. Setting hostname alias</h3>
<div class="paragraph">
<p>These steps set a more user friendly alias for the systems of the form
<em>fs1-&lt;xx&gt;</em> and <em>fs2-&lt;xx&gt;</em> where <em>&lt;xx&gt;</em> is the station&#8217;s two letter
code. This provides a compact alias for local usage, even for sites
with more than one system, and makes the system identifiable for
remote users in a systematic way. Except as noted below, these steps
should be executed for both the <em>operational</em> and <em>spare</em> systems.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Edit <em>/etc/hosts</em> and add the new aliases to the appropriate lines.</p>
<div class="paragraph">
<p>If you have two systems, add the aliases for both to the file on each
system.</p>
</div>
</li>
<li>
<p>Create a file <em>/etc/hostname_alias</em> that contains the new alias.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Execute</p>
<div class="literalblock">
<div class="content">
<pre>cd /etc
cp hostname hostname_alias
chmod a+r hostname_alias</pre>
</div>
</div>
</li>
<li>
<p>Edit the new file and change the contents to the new alias.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Change the system&#8217;s mailname</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
To allow mail to <em>mailman</em> mail lists to work, you may need to
make a use a fake FQDN name, perhaps by appending <em>.net</em> to your
alias, for use in <em>/etc/mailname</em> and
<em>/etc/exim4/update-exim4.conf.conf</em>. The two files should be
consistent.
</td>
</tr>
</table>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Edit the file <em>/etc/mailname</em> and change its contents to the new
name, without a domain name unless that is required by remote mail
hosts or mail lists. If so,
<a href="installation.html#_generate_fqdn_in_helo_for_outgoing_mail">Generate FQDN in HELO for outgoing mail</a>
in the FSL11 Installation document may also be helpful.</p>
</li>
<li>
<p>Edit <em>/etc/exim4/update-exim4.conf.conf</em>, change the value of
<code>dc_other_hostnames=</code> to the new alias</p>
</li>
<li>
<p>Execute</p>
<div class="literalblock">
<div class="content">
<pre>update-exim4.conf
systemctl restart exim4</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Use the new alias in the user prompts and <em>xterm</em> titles for <em>oper</em>, <em>prog</em>, and all non-system-administrator AUID accounts. In the
<code>.bashrc</code> file for each user to be changed:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Before the <code>if</code> block that sets <code>PS1</code> add:</p>
<div class="literalblock">
<div class="content">
<pre>hostalias_file=/etc/hostname_alias
if [[ -f "$hostalias_file" ]]; then
    hostalias=$(cat $hostalias_file)
else
    hostalias=$(hostname)
fi</pre>
</div>
</div>
</li>
<li>
<p>In the two statements setting <code>PS1</code> in the <code>if</code> block, change the
use of <code>\h</code> to <code>$hostalias</code>.</p>
</li>
<li>
<p>In the statement setting <code>PS1</code> in the <code>case</code> block that sets the
<em>xterm</em> window title, change the use of <code>\h</code> to <code>$hostalias</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For a <em>spare</em> system only, if you have one:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Update <em>/usr/local/sbin/refresh_spare_usr2</em> to use the new alias of
the <em>operational</em> system in the <em>ssh</em> line.</p>
</li>
<li>
<p>You will need to update the new alias for the <em>operational</em> system
to be recognized as a known host to the <em>root</em> account on the <em>spare</em>
system. You can do that, as <em>root</em>, by using <em>ssh</em> to
<code>spare@<em>operational</em></code> where <code><em>operational</em></code> is the new alias for the
<em>operational</em> system. The command will give you guidance for which
lines need to be deleted in <em>/root/.ssh/known_hosts</em>. After deleting
those lines, reconnect using the same <em>ssh</em> command and answer <code><strong>yes</strong></code>
to confirm connecting. The login will be rejected because of the
forced-command setup on the <em>operational</em> system. The error message
will probably not seem to make sense, but will end with a line like:
<code>Connection to <em>operational</em> closed.</code>. Still, the task of recording
the host key will have been accomplished.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installing_backup_usr2_with_cis_hardening">A.7. Installing backup_usr2 with CIS hardening</h3>
<div class="paragraph">
<p>Foe CIS hardened systems, the <em>backup_usr2</em> script is used on the
<em>operational</em> system to backup its <em>/usr2</em> partition to the <em>spare</em>
system. To do this, it invokes <em>refresh_spare_usr2</em> on the <em>spare</em>
system. This is useful if to want the <em>spare</em> system to be a
reasonably up-to-date backup system for operations. All steps for
installation must be performed as <em>root</em> on the specified system. You
should read all of the procedure before using it.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Read the introduction of the
<a href="raid.html#_refresh_spare_usr2">refresh_spare_usr2</a> section of the
<a href="raid.html">RAID Notes for FSL11</a> document for important information
on the <em>refresh_spare_usr2</em> script.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Please see the <strong>NOTE</strong> in the
<a href="#_enable_operators_group_accounts_to_rotate_disks">Enable operators group accounts to rotate disks</a> step in this
appendix for an explanation of how the so-called <em>sudo</em> and AUID
scripts, also used here, interact.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the <em>operational</em> system:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create <em>spare</em> account. Execute:</p>
<div class="listingblock">
<div class="content">
<pre>adduser spare</pre>
</div>
</div>
<div class="paragraph">
<p>Enter a suitable password when prompted and confirm it. Answer all
other questions with <kbd>Enter</kbd>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The user&#8217;s home directory is on <em>/home</em> (by default), not
<em>/usr2</em>.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>On the <em>spare</em> system:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Make sure the <em>operational</em> system is represented in the
<em>/etc/hosts</em> file.</p>
<div class="paragraph">
<p>If it is not already there, add it. It is recommended that it be given
a simple alias for routine use.</p>
</div>
</li>
<li>
<p>Install the <em>sudo</em> script <em>refresh_spare_usr2</em>:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Move the script into position:</p>
<div class="literalblock">
<div class="content">
<pre>~/fsl11/RAID/install_refresh_spare_usr2</pre>
</div>
</div>
</li>
<li>
<p>Customize <em>/usr/local/sbin/refresh_spare_usr2</em>, following the
directions in the comments in the script (repeated here):</p>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>Comment-out the lines (add leading <code>#</code>s):</p>
<div class="literalblock">
<div class="content">
<pre>echo "This script must be customized before use.  See script for details."
exit 1</pre>
</div>
</div>
</li>
<li>
<p>Change the <code>operational</code> in the line:</p>
<div class="literalblock">
<div class="content">
<pre>remote_node=operational</pre>
</div>
</div>
<div class="paragraph">
<p>to the alias (preferred), FQDN, or IP address of your <em>operational</em>
system.</p>
</div>
</li>
<li>
<p>Uncomment the line for CIS hardened systems. The commented out
form is:</p>
<div class="literalblock">
<div class="content">
<pre>#remote_user=spare</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Enable running the <em>sudo</em> script with either with no options or
just <code>-h</code>. Use <em>visudo</em> to add:</p>
<div class="literalblock">
<div class="content">
<pre>%operators         ALL=(ALL) /usr/local/sbin/refresh_spare_usr2 ""
%operators         ALL=(ALL) /usr/local/sbin/refresh_spare_usr2 -h</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Create a key for <em>root</em>:</p>
<div class="paragraph">
<p>If <em>root</em> already has a key, you should skip this sub-step.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Your should <em>not</em> set a passphrase.
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre>ssh-keygen</pre>
</div>
</div>
</li>
<li>
<p>Copy the key:</p>
<div class="listingblock">
<div class="content">
<pre>ssh-copy-id spare@<em>operational</em></pre>
</div>
</div>
<div class="paragraph">
<p>where <code><em>operational</em></code> is the alias, name, or IP of your <em>operational</em>
system.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>On the <em>operational</em> system:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Set the <em>spare</em> account to only allow a <em>forced command</em> with <em>ssh</em>
by replacing the <code>ssh-rsa</code> at the start of the first (and only) line of
<em>~spare/.ssh/authorized_keys</em> line with:</p>
<div class="paragraph">
<p><code>command="sudo --preserve-env rrsync -ro /usr2" ssh-rsa</code></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
If your <em>spare</em> system is registered with DNS, you can provide
some additional security by adding <code>from="<em>node</em>" </code> &#160;(note
the trailing space) at the start of the line, where <code><em>node</em></code> is the
FQDN or IP address of the <em>spare</em> system.  It may be necessary to
provide the FQDN, IP address, and/or alias of the <em>spare</em> system in a
comma separated list in place of  <code><em>node</em></code> to get reliable
operation.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Setup the <em>spare</em> account to run <em>rrsync</em> with <em>sudo</em> with a
password (which will make <em>refresh_spare_usr2</em> fail unless it is used
with the procedure in the <a href="#_using_backup_usr2_with_cis_hardening">Using backup_usr2 with CIS hardening</a>
section below) and with passing environment variables. Use <em>visudo</em> to
add:</p>
<div class="literalblock">
<div class="content">
<pre>spare          ALL=(ALL) SETENV: /usr/bin/rrsync</pre>
</div>
</div>
</li>
<li>
<p>Setup <em>sudo</em> on the <em>operational</em> machine to allow <code>operators</code> to
run the <em>backup_usr2</em> script with:</p>
<div class="literalblock">
<div class="content">
<pre>%operators      ALL=(ALL) /usr/local/sbin/backup_usr2</pre>
</div>
</div>
</li>
<li>
<p>Install the <em>sudo</em> script <em>backup_usr2</em>:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Move the script into position:</p>
<div class="literalblock">
<div class="content">
<pre>~/fsl11/RAID/install_backup_usr2</pre>
</div>
</div>
</li>
<li>
<p>Customize <em>/usr/local/sbin/backup_usr2</em> following the directions
in the comments in the script (repeated here):</p>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>Comment-out the lines (add leading <code>#</code>s):</p>
<div class="literalblock">
<div class="content">
<pre>echo "This script must be customized before use.  See script for details."
exit 1</pre>
</div>
</div>
</li>
<li>
<p>Change the <code>spare</code> in the line:</p>
<div class="literalblock">
<div class="content">
<pre>remote_node=spare</pre>
</div>
</div>
<div class="paragraph">
<p>to the alias (preferred), FQDN, or IP address of your <em>spare</em> system.</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Install the AUID script that runs the <em>sudo</em> script:</p>
<div class="literalblock">
<div class="content">
<pre>~/fsl11/AUID/install_backup_usr2</pre>
</div>
</div>
</li>
<li>
<p>Lock-out the <em>spare</em> account from normal login (but it must have a
shell). This will disable password login, but not <em>ssh</em> login with
keys, for this account. Execute:</p>
<div class="listingblock">
<div class="content">
<pre>usermod -L spare</pre>
</div>
</div>
</li>
<li>
<p>Disable password aging and account inactivity expiration for the
<em>spare</em> account. Execute:</p>
<div class="listingblock">
<div class="content">
<pre>chage -I -1 -M 99999 spare</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_using_backup_usr2_with_cis_hardening">A.8. Using backup_usr2 with CIS hardening</h3>
<div class="paragraph">
<p>To use <em>backup_usr2</em> as part of a monthly backup, you first should
perform a disk rotation on both systems.  The disk rotation procedure
is described in the <a href="raid.html#_disk_rotation">Disk rotation</a> section
of the <a href="raid.html">RAID Notes for FSL11</a> document. You should start
a disk rotation on the <em>spare</em> system (e.g., <em>fs2</em>) first. Once
this is successfully refreshing, log out of the <em>spare</em> system. Then
start a disk rotation running on the <em>operational</em> system (e.g.,
<em>fs1</em>).  Once that is successfully refreshing, don&#8217;t log out.
Proceed directly to the instructions below.</p>
</div>
<div class="paragraph">
<p>You can also use the procedure below to &#8220;freshen&#8221; the <em>/usr2</em> on the
<em>spare</em> system at other times.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For CIS hardened systems, the <em>backup_usr2</em> script is used on
the <em>operational</em> system to backup its <em>/usr2</em> partition to the
<em>spare</em> system. To do this, it invokes <em>refresh_spare_usr2</em> on the
<em>spare</em> system.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start with no one logged into either system.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Before proceeding, make sure that no one is logged into either system
and that no processes are running on <em>/usr2</em> on either system,
particularly the FS.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
If the only session logged on the systems is the AUID session you
used to start the disk refresh on the <em>operational</em> system, and there
is no other activity on <em>/usr2</em>, you can use that session in the
directions below without logging out first.
</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>On the <em>operational</em> system:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Login to your AUID account if you aren&#8217;t already logged in.</p>
</li>
<li>
<p>Run:</p>
<div class="literalblock">
<div class="content">
<pre>backup_usr2</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You may be prompted for your AUID password on the <em>operational</em>
system in order to run the script if it has been more than 15 minutes
since you used <em>sudo</em> in that session, e.g., to start a refresh.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You may be prompted for your AUID password for the <em>spare</em> system in
order to connect to that system.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
You can eliminate this password prompt by copying the <em>ssh</em> key
from the <em>root</em> account on the <em>operational</em> system to your AUID
account on the <em>spare</em> system (and to the <em>operational</em> system). See
the section <a href="#_copy_ssh_key_for_running_backup_usr2">Copy ssh key for running backup_usr2</a> above for
instructions.
</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <em>refresh_spare_usr2</em> script will be run on the <em>spare</em> system
automatically.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You will be prompted for your AUID password for the <em>spare</em>
system in order to run <em>refresh_spare_usr2</em> on that system with
<em>sudo</em>. It is not possible to eliminate this prompt.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Answer the question <code><strong>y</strong></code> if it is safe to proceed.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Log out of the <em>operational</em> system.</p>
</li>
<li>
<p>Wait until the <em>refresh_spare_usr2</em> script on the <em>spare</em> system
has finished before logging in again and resuming other activities on
the systems.</p>
<div class="paragraph">
<p>This step (and procedure) continues at the <a href="raid.html#wait">Wait</a>
step in the <a href="raid.html#_using_refresh_spare_usr2">Using
refresh_spare_usr2</a> subsection of the
<a href="raid.html#_refresh_spare_usr2">refresh_spare_usr2</a> subsection of the
<a href="raid.html">RAID Notes for FSL11</a> document.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-04-30 09:34:03 -0400
</div>
</div>
</body>
</html>